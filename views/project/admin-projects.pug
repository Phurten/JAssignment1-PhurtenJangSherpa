extends ../common/admin-layout

block layout-content 
  .main-content.admin-projects
    .page-header
      h1.page-title Projects 
      button-secondary.btn.btn-success(onclick="openModal('addProjectModal')") Add New Project
    
    if error
      .alert.alert-error #{error}
    
    if projects && projects.length > 0
      .admin-table
        table
          thead
            tr
              th Title
              th Description
              th Technologies
              th Status
              th End Year
              th Actions
          tbody
            each project in projects
              tr
                td
                  strong #{project.title}
                td #{project.description || 'No description'}
                td
                  if project.technologies && project.technologies.length > 0
                    | #{project.technologies.join(', ')}
                  else
                    | -
                td
                  if project.status
                    span.status(class="status-" + project.status) #{project.status}
                  else
                    | -
                td
                  if project.endYear
                    | #{project.endYear}
                  else
                    | -
                td.actions
                  div.operations
                    button.btn.btn-icon.btn-primary(onclick="openEditModal('editProjectModal', '" + project._id + "')", title="Edit project")
                      i.ph.ph-pencil-simple
                    a.btn.btn-icon.btn-danger(href="/admin/projects/delete/" + project._id, onclick="return confirm('Are you sure you want to delete this project?')", title="Delete project")
                      i.ph.ph-trash-simple
    else
      .empty-state
        p No projects found. 
        button-secondary.btn.btn-primary(onclick="openModal('addProjectModal')") Add your first project

  //add project modal
  .modal-overlay#addProjectModal
    .modal
      .modal-header
        h2.modal-title Add New Project
        button.modal-close ×
      .modal-body
        form.modal-form(action="/admin/projects/add", method="post", enctype="multipart/form-data")
          .form-group
            label(for="title") Project Title *
            input(type="text", id="title", name="title", required)
          
          .form-group
            label(for="description") Description *
            textarea(id="description", name="description", rows="3", required)
          
          .form-group
            label(for="technologies") Technologies (comma separated)
            input(type="text", id="technologies", name="technologies", placeholder="JavaScript, Node.js, MongoDB")
          
          .form-group
            label(for="githubUrl") GitHub URL
            input(type="url", id="githubUrl", name="githubUrl")
          
          .form-group
            label(for="liveUrl") Live Demo URL
            input(type="url", id="liveUrl", name="liveUrl")
          
          .form-group
            label(for="imageUrl") Project Image URL
            input(type="url", id="imageUrl", name="imageUrl")
          
          .form-group
            label(for="imageFile") Or Upload Image
            input(type="file", id="imageFile", name="imageFile", accept="image/*")
          
          .form-group
            label(for="status") Status
            select(id="status", name="status")
              option(value="") Select status
              option(value="planned") Planned
              option(value="in-progress") In Progress
              option(value="completed") Completed
              option(value="active") Active
          
          .form-group
            label(for="endYear") End Year
            input(type="number", id="endYear", name="endYear", min="2000", max="2030", placeholder="2024")
          
          .modal-footer
            button.btn.btn-secondary(type="button", onclick="modal.close()") Cancel
            button.btn.btn-primary(type="submit") Add Project

  //edit project modal
  .modal-overlay#editProjectModal
    .modal
      .modal-header
        h2.modal-title Edit Project
        button.modal-close ×
      .modal-body
        form.modal-form(id="editProjectForm", method="post", enctype="multipart/form-data")
          .form-group
            label(for="edit-title") Project Title *
            input(type="text", id="edit-title", name="title", required)
          
          .form-group
            label(for="edit-description") Description *
            textarea(id="edit-description", name="description", rows="3", required)
          
          .form-group
            label(for="edit-technologies") Technologies (comma separated)
            input(type="text", id="edit-technologies", name="technologies", placeholder="JavaScript, Node.js, MongoDB")
          
          .form-group
            label(for="edit-githubUrl") GitHub URL
            input(type="url", id="edit-githubUrl", name="githubUrl")
          
          .form-group
            label(for="edit-liveUrl") Live Demo URL
            input(type="url", id="edit-liveUrl", name="liveUrl")
          
          .form-group
            label(for="edit-imageUrl") Project Image URL
            input(type="url", id="edit-imageUrl", name="imageUrl")
          
          .form-group
            label(for="edit-imageFile") Or Upload New Image
            input(type="file", id="edit-imageFile", name="imageFile", accept="image/*")
          
          .form-group
            label(for="edit-status") Status
            select(id="edit-status", name="status")
              option(value="") Select status
              option(value="planned") Planned
              option(value="in-progress") In Progress
              option(value="completed") Completed
              option(value="active") Active
          
          .form-group
            label(for="edit-endYear") End Year
            input(type="number", id="edit-endYear", name="endYear", min="2000", max="2030", placeholder="2024")
          
          .modal-footer
            button.btn.btn-secondary(type="button", onclick="modal.close()") Cancel
            button.btn.btn-primary(type="submit") Update Project

  script.
    //project data for modals
    const projectsData = !{JSON.stringify(projects || [])};
    
    //function to open edit modal with project data
    function openEditModal(modalId, projectId) {
      const project = projectsData.find(p => p._id === projectId);
      if (!project) return;
      
      //populate form fields
      document.getElementById('edit-title').value = project.title || '';
      document.getElementById('edit-description').value = project.description || '';
      document.getElementById('edit-technologies').value = project.technologies ? project.technologies.join(', ') : '';
      document.getElementById('edit-githubUrl').value = project.githubUrl || '';
      document.getElementById('edit-liveUrl').value = project.liveUrl || '';
      document.getElementById('edit-imageUrl').value = project.imageUrl || '';
      document.getElementById('edit-status').value = project.status || '';
      document.getElementById('edit-endYear').value = project.endYear || '';
      
      //setting form action
      document.getElementById('editProjectForm').action = `/admin/projects/edit/${projectId}`;
      
      //open modal
      openModal(modalId);
    }
