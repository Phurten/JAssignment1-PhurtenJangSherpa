extends ../common/admin-layout

block layout-content 
  .main-content.admin-skills
    .page-header
      h1.page-title Skills Management
      button-secondary.btn.btn-success(onclick="openModal('addSkillModal')") Add New Skill
    
    if error
      .alert.alert-error #{error}
    
    if skills && skills.length > 0
      .admin-table
        table
          thead
            tr
              th Name
              th Category
              th Proficiency
              th Experience
              th Actions
          tbody
            each skill in skills
              tr
                td
                  strong #{skill.name}
                td #{skill.category || '-'}
                td
                  .proficiency-display
                    span.proficiency-text #{skill.proficiency || 0}/5
                    .proficiency-bar
                      .proficiency-fill(style="width: " + (skill.proficiency * 20) + "%")
                td
                  if skill.yearsOfExperience
                    | #{skill.yearsOfExperience} years
                  else
                    | -
                td.actions
                  div.operations
                    button.btn.btn-icon.btn-primary(onclick="openEditModal('editSkillModal', '" + skill._id + "')", title="Edit skill")
                      i.ph.ph-pencil-simple
                    a.btn.btn-icon.btn-danger(href="/admin/skills/delete/" + skill._id, onclick="return confirm('Are you sure you want to delete this skill?')", title="Delete skill")
                      i.ph.ph-trash-simple
    else
      .empty-state
        p No skills found. 
        button-secondary.btn.btn-primary(onclick="openModal('addSkillModal')") Add your first skill

  //add skill modal
  .modal-overlay#addSkillModal
    .modal
      .modal-header
        h2.modal-title Add New Skill
        button.modal-close ×
      .modal-body
        form.modal-form.bypass-modal-js(action="/admin/skills/add", method="post")
          .form-group
            label(for="name") Skill Name *
            input(type="text", id="name", name="name", required)
          
          .form-group
            label(for="category") Category *
            select(id="category", name="category", required)
              option(value="") Select category
              option(value="Frontend") Frontend
              option(value="Backend") Backend
              option(value="Database") Database
              option(value="DevOps") DevOps
              option(value="Mobile") Mobile
              option(value="Design") Design
              option(value="Other") Other
          
          .form-group
            label(for="proficiency") Proficiency Level (1-5) *
            select(id="proficiency", name="proficiency", required)
              option(value="") Select level
              option(value="1") 1 - Beginner
              option(value="2") 2 - Basic
              option(value="3") 3 - Intermediate
              option(value="4") 4 - Advanced
              option(value="5") 5 - Expert
          
          .form-group
            label(for="yearsOfExperience") Years of Experience
            input(type="number", id="yearsOfExperience", name="yearsOfExperience", min="0", step="0.5")
          
          .modal-footer
            button.btn.btn-secondary(type="button", onclick="closeModal('addSkillModal')") Cancel
            button.btn.btn-primary(type="submit") Add Skill

  //edit skill modal
  .modal-overlay#editSkillModal
    .modal
      .modal-header
        h2.modal-title Edit Skill
        button.modal-close ×
      .modal-body
        form.modal-form(id="editSkillForm", method="post")
          .form-group
            label(for="edit-skill-name") Skill Name *
            input(type="text", id="edit-skill-name", name="name", required)
          
          .form-group
            label(for="edit-skill-category") Category *
            select(id="edit-skill-category", name="category", required)
              option(value="") Select category
              option(value="Frontend") Frontend
              option(value="Backend") Backend
              option(value="Database") Database
              option(value="DevOps") DevOps
              option(value="Mobile") Mobile
              option(value="Design") Design
              option(value="Other") Other
          
          .form-group
            label(for="edit-skill-proficiency") Proficiency Level (1-5) *
            select(id="edit-skill-proficiency", name="proficiency", required)
              option(value="") Select level
              option(value="1") 1 - Beginner
              option(value="2") 2 - Basic
              option(value="3") 3 - Intermediate
              option(value="4") 4 - Advanced
              option(value="5") 5 - Expert
          
          .form-group
            label(for="edit-skill-years") Years of Experience
            input(type="number", id="edit-skill-years", name="yearsOfExperience", min="0", step="0.5")
          
          .modal-footer
            button.btn.btn-secondary(type="button", onclick="closeModal('editSkillModal')") Cancel
            button.btn.btn-primary(type="submit") Update Skill

  script.
    //skills data for modals
    const skillsData = !{JSON.stringify(skills || [])};
    
    //function to open edit modal with skill data
    function openEditModal(modalId, skillId) {
      const skill = skillsData.find(s => s._id === skillId);
      if (!skill) return;
      
      //populate form fields
      document.getElementById('edit-skill-name').value = skill.name || '';
      document.getElementById('edit-skill-category').value = skill.category || '';
      document.getElementById('edit-skill-proficiency').value = skill.proficiency || '';
      document.getElementById('edit-skill-years').value = skill.yearsOfExperience || '';
      
      //setting form action
      document.getElementById('editSkillForm').action = `/admin/skills/edit/${skillId}`;
      
      //open modal
      openModal(modalId);
    }
